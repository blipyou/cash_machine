<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é“¶æ²³æˆ˜èˆ° Â· åŸºé‡‘ç»ç†é…ç½®å° V6.0</title>
    <style>
        :root { --primary: #108ee9; --accent: #ff5722; --bg: #f0f2f5; --card-bg: #fff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: #333; margin: 0; padding: 20px; display:flex; justify-content:center; }
        .container { width: 100%; max-width: 600px; background: var(--card-bg); border-radius: 16px; box-shadow: 0 6px 20px rgba(0,0,0,0.08); padding: 24px; }
        
        h1 { text-align: center; color: var(--primary); margin: 0 0 20px 0; font-size: 22px; border-bottom: 2px solid #e8e8e8; padding-bottom: 15px; }
        
        /* æ …æ ¼å¸ƒå±€ */
        .grid-row { display: flex; gap: 15px; margin-bottom: 15px; }
        .col { flex: 1; }
        
        label { display: block; font-size: 13px; font-weight: 600; color: #555; margin-bottom: 6px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #d9d9d9; border-radius: 6px; font-size: 15px; box-sizing: border-box; background: #fafafa; transition:0.3s; }
        input:focus, select:focus { border-color: var(--primary); background: #fff; outline: none; }
        
        .section-header { font-size: 14px; font-weight: bold; color: #108ee9; margin: 25px 0 10px 0; display:flex; align-items:center; }
        .section-header::before { content:''; display:inline-block; width:4px; height:14px; background:#108ee9; margin-right:8px; border-radius:2px; }

        .btn { width: 100%; padding: 14px; background: var(--primary); color: #fff; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; box-shadow: 0 4px 10px rgba(16, 142, 233, 0.3); }
        .btn:hover { background: #0e77ca; }

        /* ç»“æœå¡ç‰‡ */
        .result-area { display: none; margin-top: 25px; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity:0; transform:translateY(15px); } to { opacity:1; transform:translateY(0); } }

        .card { background: #fff; border: 1px solid #e8e8e8; border-radius: 10px; padding: 16px; margin-bottom: 16px; position: relative; overflow: hidden; }
        .card::after { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; }
        .card-blue::after { background: var(--primary); }
        .card-red::after { background: var(--accent); }

        .data-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 14px; }
        .data-val { font-weight: 700; color: #333; }
        .big-num { font-size: 18px; color: var(--accent); }
        .profit-num { font-size: 20px; color: #27a646; }
        
        .tag { font-size: 11px; padding: 2px 6px; border-radius: 4px; color: #fff; margin-left:5px; vertical-align: middle; }
        .tag-rec { background: #faad14; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ§­ åŸºé‡‘ç»ç†é…ç½®å° V6.0</h1>

    <!-- èµ„é‡‘ä¸æ ‡çš„ -->
    <div class="section-header">ç¬¬ä¸€æ­¥ï¼šåŸºç¡€æ•°æ®è¾“å…¥</div>
    <div class="grid-row">
        <div class="col">
            <label>æŠ•å…¥æ€»èµ„é‡‘ (å…ƒ)</label>
            <input type="number" id="capital" step="1000" placeholder="å¦‚ 50000" onchange="calculate()">
        </div>
        <div class="col">
            <label>å½“å‰ä»·æ ¼ (å…ƒ)</label>
            <input type="number" id="price" step="0.001" placeholder="å¦‚ 1.000" onchange="calculate()">
        </div>
    </div>

    <!-- ä¼°å€¼ä¸æ³¢åŠ¨ -->
    <div class="grid-row">
        <div class="col">
            <label>ä¼°å€¼ç™¾åˆ†ä½ (%) <span style="font-weight:normal;color:#999;font-size:11px">å†³å®šåº•ä»“</span></label>
            <input type="number" id="percentile" placeholder="0-100" value="50" onchange="calculate()">
        </div>
        <div class="col">
            <label>è¿‘ä¸€å¹´æ³¢åŠ¨ (é«˜ç‚¹/ä½ç‚¹)</label>
            <div style="display:flex; gap:5px;">
                <input type="number" id="lowYear" step="0.1" placeholder="æœ€ä½" onchange="calculate()">
                <input type="number" id="highYear" step="0.1" placeholder="æœ€é«˜" onchange="calculate()">
            </div>
        </div>
    </div>

    <!-- æ ¸å¿ƒå†³ç­–å‚æ•° -->
    <div class="section-header">ç¬¬äºŒæ­¥ï¼šåŸºé‡‘ç»ç†å†³ç­– (é«˜çº§å‚æ•°)</div>
    <div class="grid-row">
        <div class="col">
            <label>äº¤æ˜“é£æ ¼åå¥½</label>
            <select id="style" onchange="calculate()">
                <option value="high_freq">âš¡ é«˜é¢‘åˆ·å• (æ­¥é•¿æå°)</option>
                <option value="balanced" selected>âš–ï¸ ç¨³å¥æ³¢æ®µ (æ­¥é•¿é€‚ä¸­)</option>
                <option value="trend">ğŸŒŠ å¤§æµªæ·˜æ²™ (æ­¥é•¿å¾ˆå¤§)</option>
            </select>
        </div>
        <div class="col">
            <label>èµ„é‡‘åˆ‡å‰²ä»½æ•° (æ ¼å­)</label>
            <input type="number" id="gridCount" value="30" onchange="calculate()">
        </div>
    </div>

    <button class="btn" onclick="calculate()">ç”Ÿæˆç²¾å‡†ç­–ç•¥</button>

    <!-- ç»“æœè¾“å‡º -->
    <div class="result-area" id="result">
        
        <!-- ä»“ä½å¡ç‰‡ -->
        <div class="card card-blue">
            <div class="data-row" style="border-bottom:1px dashed #eee; padding-bottom:8px; margin-bottom:10px;">
                <span style="color:#108ee9; font-weight:bold;">ğŸŸ¢ æ™ºèƒ½å»ºä»“æ–¹æ¡ˆ</span>
                <span id="pos-desc" style="font-size:12px; color:#999">--</span>
            </div>
            <div class="data-row">
                <span>æ‰‹åŠ¨ä¹°å…¥åº•ä»“</span>
                <span class="data-val big-num" style="color:#333" id="res-base-shares">--</span>
            </div>
            <div class="data-row">
                <span>æ¶ˆè€—èµ„é‡‘</span>
                <span class="data-val" id="res-base-cost">--</span>
            </div>
            <div class="data-row">
                <span>ä¿ç•™é˜²å¾¡ç°é‡‘ (ç»™æœºå™¨)</span>
                <span class="data-val" style="color:#27a646" id="res-cash">--</span>
            </div>
        </div>

        <!-- ç½‘æ ¼å‚æ•°å¡ç‰‡ -->
        <div class="card card-red">
            <div class="data-row" style="border-bottom:1px dashed #eee; padding-bottom:8px; margin-bottom:10px;">
                <span style="color:#ff5722; font-weight:bold;">ğŸ”´ é“¶æ²³æ¡ä»¶å•å¡«ç©º</span>
                <span style="font-size:12px; color:#999">ä¸‡0.5æé€Ÿè´¹ç‡ä¼˜åŒ–</span>
            </div>
            
            <div class="grid-row" style="margin-bottom:0">
                <div class="col">
                    <span style="font-size:12px; color:#666; display:block">åŒºé—´ä¸‹é™</span>
                    <span class="data-val" id="res-low">--</span>
                </div>
                <div class="col" style="text-align:center">
                    <span style="font-size:12px; color:#666; display:block">ç½‘æ ¼æ­¥é•¿</span>
                    <span class="data-val big-num" id="res-step">--</span>
                </div>
                <div class="col" style="text-align:right">
                    <span style="font-size:12px; color:#666; display:block">åŒºé—´ä¸Šé™</span>
                    <span class="data-val" id="res-high">--</span>
                </div>
            </div>

            <div style="background:#fff7e6; padding:12px; border-radius:6px; margin-top:10px; border:1px solid #ffe7ba;">
                <div class="data-row">
                    <span>æ¯ç¬”å§”æ‰˜æ•°é‡</span>
                    <span class="data-val" style="color:#d48806; font-size:18px" id="res-qty">--</span>
                </div>
                <div class="data-row" style="margin-bottom:0">
                    <span>å•ç½‘æ ¼é¢„æœŸå‡€åˆ©</span>
                    <span class="data-val profit-num" id="res-profit">--</span>
                </div>
                <div style="text-align:right; font-size:11px; color:#999; margin-top:5px;">
                    *å·²æ‰£é™¤ä¹°å–åŒå‘æ‰‹ç»­è´¹(æœ€ä½0.2å…ƒ)
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    function calculate() {
        // 1. è·å–è¾“å…¥
        const capital = parseFloat(document.getElementById('capital').value);
        const price = parseFloat(document.getElementById('price').value);
        const percentile = parseFloat(document.getElementById('percentile').value);
        const lowYear = parseFloat(document.getElementById('lowYear').value);
        const highYear = parseFloat(document.getElementById('highYear').value);
        const style = document.getElementById('style').value;
        const gridCount = parseInt(document.getElementById('gridCount').value);

        if (!capital || !price || !lowYear || !highYear) return;

        // 2. æ™ºèƒ½è®¡ç®—åº•ä»“æ¯”ä¾‹ (æ ¹æ®ä¼°å€¼)
        let baseRatio = 0.3; // é»˜è®¤
        let posDesc = "ä¼°å€¼é€‚ä¸­ï¼Œæ ‡é…åº•ä»“";
        
        if (percentile < 20) {
            baseRatio = 0.45;
            posDesc = "ğŸ’ æåº¦ä½ä¼°ï¼Œé‡ä»“æ½œä¼";
        } else if (percentile > 60) {
            baseRatio = 0.15;
            posDesc = "âš ï¸ ä¼°å€¼åé«˜ï¼Œè½»ä»“é˜²å¾¡";
        } else if (percentile > 80) {
            baseRatio = 0;
            posDesc = "ğŸ”¥ æåº¦é«˜ä¼°ï¼Œå»ºè®®ç©ºä»“ç½‘æ ¼";
        }

        // 3. æ™ºèƒ½è®¡ç®—æ­¥é•¿ (æ ¹æ®æ³¢åŠ¨ç‡ + é£æ ¼åå¥½)
        const volatility = (highYear - lowYear) / lowYear; // æ³¢åŠ¨ç‡
        let step = 1.0;

        // åŸºç¡€æ­¥é•¿åŸºäºæ³¢åŠ¨ç‡
        if (volatility < 0.2) step = 0.5;
        else if (volatility < 0.4) step = 0.8;
        else step = 1.5;

        // é£æ ¼ä¿®æ­£
        if (style === 'high_freq') step = Math.max(0.3, step * 0.6); // é«˜é¢‘åˆ·å•ï¼šæ­¥é•¿æ‰“6æŠ˜
        if (style === 'trend') step = step * 1.5; // å¤§æ³¢æ®µï¼šæ­¥é•¿æ”¾å¤§

        // 4. æ™ºèƒ½åŒºé—´é”šå®š (æ ¹æ®é£æ ¼è°ƒæ•´ç¼“å†²åŒº)
        let buffer = 0.15;
        if (style === 'high_freq') buffer = 0.10; // çª„åŒºé—´
        if (style === 'trend') buffer = 0.25; // å®½åŒºé—´

        let gridLow = Math.min(price * (1 - buffer), lowYear).toFixed(3);
        let gridHigh = Math.max(price * (1 + buffer), highYear).toFixed(3);

        // 5. èµ„é‡‘è®¡ç®—
        const baseShares = Math.floor((capital * baseRatio) / price / 100) * 100;
        const baseCost = baseShares * price;
        const keepCash = capital - baseCost;

        // å•ç¬”å§”æ‰˜ (æ€»èµ„é‡‘/æ ¼å­æ•° vs å‰©ä½™ç°é‡‘/æ ¼å­æ•°? æ¨èç”¨æ€»èµ„é‡‘é”šå®šä»¥ä¿è¯åšåº¦)
        let perGridShares = Math.floor((capital / gridCount) / price / 100) * 100;
        if (perGridShares < 100) perGridShares = 100; // å…œåº•
        
        const perGridAmount = perGridShares * price;

        // 6. å‡€åˆ©ç²¾å‡†è®¡ç®— (ä½ çš„ä¸‡0.5 æœ€ä½0.1)
        // ä¹°å…¥æ‰‹ç»­è´¹
        const buyFee = Math.max(0.1, perGridAmount * 0.00005);
        // å–å‡ºé‡‘é¢ = ä¹°å…¥é‡‘é¢ * (1+æ­¥é•¿)
        const sellAmount = perGridAmount * (1 + step/100);
        const sellFee = Math.max(0.1, sellAmount * 0.00005);
        
        const grossProfit = perGridAmount * (step/100);
        const netProfit = grossProfit - buyFee - sellFee;

        // 7. æ¸²æŸ“
        document.getElementById('result').style.display = 'block';
        
        document.getElementById('pos-desc').innerText = posDesc;
        document.getElementById('res-base-shares').innerText = baseShares + " è‚¡";
        document.getElementById('res-base-cost').innerText = "çº¦ " + baseCost.toFixed(0) + " å…ƒ";
        document.getElementById('res-cash').innerText = keepCash.toFixed(0) + " å…ƒ";

        document.getElementById('res-low').innerText = gridLow;
        document.getElementById('res-high').innerText = gridHigh;
        document.getElementById('res-step').innerText = step.toFixed(2) + "%";
        
        document.getElementById('res-qty').innerText = perGridShares + " è‚¡";
        document.getElementById('res-profit').innerText = netProfit.toFixed(2) + " å…ƒ";
    }
</script>

</body>
</html>